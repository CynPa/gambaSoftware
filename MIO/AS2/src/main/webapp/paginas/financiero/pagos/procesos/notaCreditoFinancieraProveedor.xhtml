<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core" xmlns:p="http://primefaces.org/ui" 
	xmlns:as2="http://java.sun.com/jsf/composite/componentes">

<f:metadata>
	<f:viewParam name="numeroNotaCredito" value="#{notaCreditoFinancieraProveedorBean.numeroNotaCredito}" />
</f:metadata>

<ui:composition template="/template/template.xhtml">

	<ui:define name="contenido">

		<h:form prependId="false" id="form">

			<p:outputPanel id="panelContenedor">

				<as2:toolBar bean="#{notaCreditoFinancieraProveedorBean}">
					<as2:buttonEliminar bean="#{notaCreditoFinancieraProveedorBean}" titulo="#{msgs.btn_anular}" />
					<as2:buttonExportaExcel bean="#{notaCreditoFinancieraProveedorBean}" tabla=":form:tablaNotaCreditoProveedor" />
					<as2:buttonImprimir bean="#{notaCreditoFinancieraProveedorBean}" beanReporte="#{reporteFacturaProveedorBean}"
						value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor}" target="#{reporteFacturaProveedorBean.facturaProveedor}" />
					<as2:buttonImprimir beanReporte="#{reporteAsientoBean}" bean="#{notaCreditoFinancieraProveedorBean}" target="#{reporteAsientoBean.asiento}"
						value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.asiento}" etiquetaImprimir="#{msgs.lbl_imprimir_asiento}"/>	
				</as2:toolBar>

				<p:outputPanel id="panelNuevo">

					<p:panel header="#{msgs.lbl_panel_edicion} #{msgs.lbl_nota_credito_proveedor_panel}" rendered="#{notaCreditoFinancieraProveedorBean.editado}">

						<ui:include src="/template/listaProductoMultiple.xhtml">
							<ui:param name="bean" value="#{notaCreditoFinancieraProveedorBean}" />
							<ui:param name="objetoActualizar" value=":form:tabView:panelDetalleFactura" />
							<ui:param name="listadoFiltrado" value="true" />
							<ui:param name="mostrarCantidad" value="false" />
						</ui:include>

						<p:fieldset>

							<h:panelGrid id="panelCabecera" columns="#{notaCreditoFinancieraProveedorBean.numeroColumnasPanelNuevo}"
								columnClasses="columnaEtiqueta,columnaValor,columnaEtiqueta,columnaValor">

								<h:outputText value="#{msgs.lbl_documento}:" />
								<p:selectOneMenu styleClass="input-text" value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.documento}" id="cboDocumento"
									required="true">
									<f:selectItem itemValue="" itemLabel="#{msgs.lbl_seleccione}" />
									<f:selectItems value="#{notaCreditoFinancieraProveedorBean.listaDocumento}" var="_documento" itemLabel="#{_documento.nombre}"
										itemValue="#{_documento}" />

									<p:ajax update=":form:txtNumero :form:panelTributario :form:cboCondicionPago" event="change" global="false"
										listener="#{notaCreditoFinancieraProveedorBean.actualizarDocumento}" process="@this,:form:calFecha,txtNumero" />

									<f:validateBean />
								</p:selectOneMenu>

								<h:outputText value="#{msgs.lbl_numero}:" />
								<p:inputMask styleClass="input-text" value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.numero}" id="txtNumero"
									mask="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.documento.secuencia.patron}"
									disabled="#{!notaCreditoFinancieraProveedorBean.secuenciaEditable}">
									<f:validateBean />
								</p:inputMask>

								<h:outputText value="#{msgs.lbl_fecha}:" />
								<p:calendar pattern="#{notaCreditoFinancieraProveedorBean.formatoFecha}" showOn="button" navigator="true"
									value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.fecha}" id="calFecha" required="true">
								</p:calendar>

								<p:outputLabel for="cboMotivo" value="#{msgs.lbl_motivo}:" />
								<p:selectOneMenu styleClass="input-text" value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.motivoNotaCreditoProveedor}"
									id="cboMotivo" required="true">
									<f:selectItem itemValue="" itemLabel="#{msgs.lbl_seleccione}" />
									<f:selectItems value="#{notaCreditoFinancieraProveedorBean.listaMotivoNotaCreditoProveedor}" var="_motivo" itemLabel="#{_motivo.nombre}"
										itemValue="#{_motivo}" />

									<p:ajax process="@this" />

									<f:validateBean />
								</p:selectOneMenu>

								<p:outputLabel for="autoEmpresa" value="#{msgs.lbl_proveedor}:" />
								<p:autoComplete queryDelay="#{sesionControler.retrasoFiltro}" styleClass="input-text" id="autoEmpresa"
									value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.empresa}"
									completeMethod="#{notaCreditoFinancieraProveedorBean.autocompletarProveedors}" var="_proveedor" itemLabel="#{_proveedor.nombreFiscal}"
									itemValue="#{_proveedor}" forceSelection="true" dropdown="true" minQueryLength="2" required="true">

									<p:column headerText="#{msgs.lbl_empresa_identificacion}">#{_proveedor.identificacion}</p:column>
									<p:column headerText="#{msgs.lbl_empresa_nombre_fiscal}">#{_proveedor.nombreFiscal}</p:column>
									<p:column headerText="#{msgs.lbl_empresa_nombre_comercial}">#{_proveedor.nombreComercial}</p:column>

									<p:ajax listener="#{notaCreditoFinancieraProveedorBean.actualizarProveedor}" process="@this" event="itemSelect"
										update=":form:autoFactura,:form:cboCondicionPago, :form:cboCreditoTributarioSRI" />

								</p:autoComplete>

								<p:outputPanel>
									<h:outputText value="#{msgs.lbl_condicion_pago}:" />
								</p:outputPanel>
								<p:selectOneMenu styleClass="input-text" value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.condicionPago}"
									id="cboCondicionPago" required="true"
									disabled="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.documento.documentoBase != 'NOTA_DEBITO_PROVEEDOR'}">
									<f:selectItem itemValue="" itemLabel="#{msgs.lbl_seleccione}" />
									<f:selectItems value="#{notaCreditoFinancieraProveedorBean.listaCondicionPago}" var="_condicionPago" itemLabel="#{_condicionPago.nombre}"
										itemValue="#{_condicionPago}" />
									<f:validateBean />
								</p:selectOneMenu>

								<p:outputLabel for="autoFactura" value="#{msgs.lbl_factura}:" />
								<p:autoComplete queryDelay="#{sesionControler.retrasoFiltro}" styleClass="input-text" id="autoFactura"
									value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.facturaProveedorPadre}"
									completeMethod="#{notaCreditoFinancieraProveedorBean.autocompletarFacturas}" var="_factura"
									itemLabel="#{not empty _factura.facturaProveedorSRI ?  _factura.facturaProveedorSRI.numeroComprobante : _factura.numero}"
									itemValue="#{_factura}" forceSelection="true" dropdown="true" minQueryLength="2" required="true">

									<p:column>
										<h:outputText
											value="#{_factura.facturaProveedorSRI.establecimiento}-#{_factura.facturaProveedorSRI.puntoEmision}-#{_factura.facturaProveedorSRI.numero}" />
									</p:column>

									<p:column>
										<h:outputText value="#{_factura.numero}" />
									</p:column>

									<p:column>
										<h:outputText value=" #{_factura.fecha}">
											<f:convertDateTime pattern="#{notaCreditoFinancieraProveedorBean.formatoFecha}" />
										</h:outputText>
									</p:column>

									<p:column>
										<h:outputText value="#{_factura.referencia3}" />
									</p:column>

									<p:ajax listener="#{notaCreditoFinancieraProveedorBean.cargarDetalleNotaCreditoProveedor}" process="@this" event="itemSelect"
										update=":form:cboCreditoTributarioSRI, :form:tabView:panelDetalleFactura,:form:tabView:panelImpuestoDetalle,:form:tabView:panelContabilidad,:form:txtTotalFactura" />
								</p:autoComplete>

								<h:outputText value="#{msgs.lbl_total_factura}:" />
								<h:outputText value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.facturaProveedorPadre.totalFactura}" id="txtTotalFactura">
									<f:convertNumber pattern="#{notaCreditoFinancieraProveedorBean.formatoDinero}" />
								</h:outputText>

								<h:outputText value="#{msgs.lbl_descripcion}:" />
								<p:inputTextarea styleClass="input-text" value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.descripcion}"
									id="txtDescripcionCabecera" size="100" maxlength="200">
									<f:validateBean />
								</p:inputTextarea>
							</h:panelGrid>

							<!-- INICIO PANEL TRIBUTARIO -->

							<p:outputPanel id="panelTributario">
								<h:panelGrid columns="#{notaCreditoFinancieraProveedorBean.numeroColumnasPanelNuevo}"
									columnClasses="columnaEtiqueta,columnaValor,columnaEtiqueta,columnaValor"
									rendered="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.documento.indicadorDocumentoTributario}">

									<h:outputText value="#{msgs.lbl_sri_credito_tributario}:" />
									<p:selectOneMenu styleClass="input-text"
										value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.facturaProveedorSRI.creditoTributarioSRI}" id="cboCreditoTributarioSRI"
										required="true" converter="creditoTributarioSRIConverter">
										<f:selectItem itemValue="" itemLabel="#{msgs.lbl_seleccione}" />
										<f:selectItems value="#{notaCreditoFinancieraProveedorBean.listaCreditoTributarioSRI}" var="_creditoTributario"
											itemLabel="#{_creditoTributario.codigo}  #{_creditoTributario.nombre}" itemValue="#{_creditoTributario}" />
									</p:selectOneMenu>



									<h:outputText value="#{msgs.lbl_generacion_electronica}:" />
									<p:selectBooleanCheckbox value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.facturaProveedorSRI.indicadorFacturaElectronica}">
										<p:ajax event="change" process="@this" update=":form:txtAutorizacion" global="false"></p:ajax>
									</p:selectBooleanCheckbox>

									<h:outputText value="#{msgs.lbl_sri_serie_secuencial}:" />
									<p:outputPanel>
										<h:panelGrid columns="3" style="width: 75%;	">
											<p:inputMask value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.facturaProveedorSRI.establecimiento}" id="txtEstablecimiento"
												mask="999" size="3">
												<f:validateBean for="txtEstablecimiento" />
											</p:inputMask>

											<p:inputMask value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.facturaProveedorSRI.puntoEmision}" id="txtPuntoEmision"
												mask="999" size="3">
												<f:validateBean for="txtPuntoEmision" />
											</p:inputMask>

											<p:spinner id="txtFactura" value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.facturaProveedorSRI.numero}" min="1"
												max="999999999">
												<f:validateBean for="txtFactura" />
											</p:spinner>
										</h:panelGrid>
									</p:outputPanel>

									<h:outputText value="#{msgs.lbl_numero_autorizacion}:" />
									<p:outputPanel>
										<p:inputText id="txtAutorizacion" styleClass="input-text"
											value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.facturaProveedorSRI.autorizacion}">
											<f:validateBean for="txtAutorizacion" />
										</p:inputText>
									</p:outputPanel>

								</h:panelGrid>
							</p:outputPanel>
							<!-- FINAL PANEL TRIBUTARIO -->
						</p:fieldset>

						<p:spacer width="2px" />

						<p:tabView cache="true" id="tabView">
							<p:ajax event="tabChange" update=":form:tabView:panelContabilidad" global="false" />
							<p:tab title="#{msgs.lbl_detalle_nota_credito}" id="tabDetalleNC">
								<p:outputPanel id="panelDetalleFactura">
									<h:panelGrid columns="1" id="panelDetalle" style="width:100%">
										<h:panelGroup>
											<p:commandButton value="#{msgs.btn_agregar_detalle}" id="btnAgregarDetalle" action="#{notaCreditoFinancieraProveedorBean.agregarDetalle}"
												update=":form:tabView:panelDetalleFactura" process="@this,:form:tabView:panelDetalleFactura" icon="ui-icon-plus" />

											<p:commandButton value="#{msgs.lbl_listar_producto}" icon="ui-icon-plus" onclick="dglModalProducto.show();" type="button" />
										</h:panelGroup>

										<p:dataTable filterDelay="#{sesionControler.retrasoFiltro}" value="#{notaCreditoFinancieraProveedorBean.listaDetalleFacturaProveedor}"
											id="tablaDetalleFacturaProveedor" rowIndexVar="secuencial" binding="#{notaCreditoFinancieraProveedorBean.dtDetalleFacturaProveedor}"
											emptyMessage="#{msgs.msg_no_hay_datos}" var="_detalleNC" paginator="true" paginatorPosition="bottom" style="width:100%"
											rows="#{notaCreditoFinancieraProveedorBean.numeroFilas}" rowsPerPageTemplate="#{notaCreditoFinancieraProveedorBean.numeroFilasPorPagina}"
											rowKey="#{_detalleNC.id}">

											<p:column headerText="Nº" styleClass="columnaDTAccion tableCell">
												<h:outputText value="#{secuencial+1}" />
											</p:column>

											<p:column headerText="#{msgs.lbl_codigo}" styleClass="columnaDTCodigo tableCell">
												<p:inputText id="txtCodigoProducto" value="#{_detalleNC.producto.codigo}">
													<p:ajax listener="#{notaCreditoFinancieraProveedorBean.actualizarProductoListener}" process="@this" event="change" global="false"
														update=":form:tabView:panelDetalleFactura" />
													<f:validateBean for="txtCodigoProducto" />
												</p:inputText>
											</p:column>

											<p:column headerText="#{msgs.lbl_nombre_producto}" styleClass="tableCell">
												<h:outputText value="#{_detalleNC.producto.nombre}" />
											</p:column>

											<p:column headerText="#{msgs.lbl_precio} #{msgs.lbl_factura}" styleClass="columnaDTValor input-text-number tableCell">
												<h:outputText value="#{_detalleNC.detalleFacturaProveedorPadre.precioLinea - _detalleNC.detalleFacturaProveedorPadre.descuentoLinea}"
													id="txtPrecioLineaPadre" size="10" />
											</p:column>

											<p:column headerText="#{msgs.lbl_producto_indicador_impuestos}" styleClass="columnaDTValor input-text-number tableCell">
												<p:selectBooleanCheckbox disabled="true" value="#{_detalleNC.indicadorImpuestos}">
												</p:selectBooleanCheckbox>
											</p:column>

											<p:column headerText="#{msgs.lbl_valor}" styleClass="columnaDTValor input-text-number tableCell">
												<p:inputText value="#{_detalleNC.precio}" id="txtPrecio" size="10">
													<f:validateBean />
													<p:ajax listener="#{notaCreditoFinancieraProveedorBean.totalizar}" process="@this" event="change" global="false"
														update=":form:tabView:panelDetalleFactura, :form:tabView:panelImpuestoDetalleFactura" />
												</p:inputText>
											</p:column>

											<p:column styleClass="columnaDTAccion tableCell">
												<p:commandButton id="btnEliminarDetalle" action="#{notaCreditoFinancieraProveedorBean.eliminarDetalle}" icon="ui-icon-trash"
													title="#{msgs.lbl_eliminar}" update=":form:tabView:panelDetalleFactura" process="@this">
												</p:commandButton>
											</p:column>

											<p:columnGroup type="footer" id="panelTotal">
												<p:row>
													<p:column colspan="4" footerText="#{msgs.lbl_subtotal}:	" style="text-align:right">
													</p:column>
													<p:column>
														<f:facet name="footer" style="text-align:right">
															<h:outputText value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.total}" id="txtTotal">
																<f:convertNumber pattern="#{notaCreditoFinancieraProveedorBean.formatoDinero}" />
															</h:outputText>
														</f:facet>
													</p:column>
													<p:column></p:column>
												</p:row>
												<p:row>
													<p:column colspan="4" footerText="#{msgs.lbl_producto_indicador_impuestos}" style="text-align:right">
													</p:column>
													<p:column>
														<f:facet name="footer" colspan="10" style="text-align:right">
															<h:outputText value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.impuesto}" id="txtImpuesto">
																<f:convertNumber pattern="#{notaCreditoFinancieraProveedorBean.formatoDinero}" />
															</h:outputText>
														</f:facet>
													</p:column>
													<p:column></p:column>
												</p:row>
												<p:row>
													<p:column colspan="4" footerText="#{msgs.lbl_total}:	" style="text-align:right">
													</p:column>
													<p:column>
														<f:facet name="footer" colspan="10" style="text-align:right">
															<h:outputText value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.totalFactura}" id="txtSubtotal">
																<f:convertNumber pattern="#{notaCreditoFinancieraProveedorBean.formatoDinero}" />
															</h:outputText>
														</f:facet>
													</p:column>
													<p:column></p:column>
												</p:row>
											</p:columnGroup>
										</p:dataTable>
									</h:panelGrid>
								</p:outputPanel>
							</p:tab>

							<p:tab title="#{msgs.lbl_detalle_impuesto}" id="tabImpuestoDetalleFactura">
								<p:outputPanel id="panelImpuestoDetalleFactura">
									<h:panelGrid columns="1" id="panelImpuestoDetalle" style="width:100%">

										<p:dataTable filterDelay="#{sesionControler.retrasoFiltro}"
											value="#{notaCreditoFinancieraProveedorBean.listaImpuestoProductoFacturaProveedor}" id="tablaImpuestoDetalleFacturaProveedor"
											rowIndexVar="secuencial" binding="#{notaCreditoFinancieraProveedorBean.dtImpuestoDetalleFacturaProveedor}"
											emptyMessage="#{msgs.msg_no_hay_datos}" var="_impuestoDetalleNC" paginator="true" paginatorPosition="bottom" style="width:100%"
											rows="#{notaCreditoFinancieraProveedorBean.numeroFilas}" rowsPerPageTemplate="#{notaCreditoFinancieraProveedorBean.numeroFilasPorPagina}"
											rowKey="#{_impuestoDetalleNC.id}">

											<p:column headerText="Nº" styleClass="columnaDTAccion tableCell">
												<h:outputText value="#{secuencial+1}" />
											</p:column>

											<p:column headerText="#{msgs.lbl_nombre_producto}" styleClass="tableCell">
												<h:outputText value="#{_impuestoDetalleNC.detalleFacturaProveedor.producto.nombreComercial}" />
											</p:column>

											<p:column headerText="#{msgs.lbl_nombre_impuesto}" styleClass="columnaDTNombreCorto tableCell">
												<h:outputText value="#{_impuestoDetalleNC.impuesto.nombre}" id="txtNombreProductoImpuesto">
												</h:outputText>
											</p:column>

											<p:column headerText="#{msgs.lbl_porcentaje_impuesto}" styleClass="columnaDTValor input-text-number tableCell">
												<h:outputText value="#{_impuestoDetalleNC.porcentajeImpuesto}" id="txtPorcentajeProductoImpuesto">
													<f:convertNumber pattern="#{notaCreditoFinancieraProveedorBean.formatoDinero}" />
												</h:outputText>
											</p:column>

											<p:column headerText="#{msgs.lbl_base_imponible}" styleClass="columnaDTValor input-text-number tableCell">
												<h:outputText value="#{_impuestoDetalleNC.detalleFacturaProveedor.baseImponible}" id="txtBaseImpuesto">
													<f:convertNumber pattern="#{notaCreditoFinancieraProveedorBean.formatoDinero}" />
												</h:outputText>
											</p:column>

											<p:column headerText="#{msgs.lbl_valor_impuesto}" styleClass="columnaDTValor input-text-number tableCell">
												<h:outputText value="#{_impuestoDetalleNC.impuestoProducto}" id="txtImpuestoProducto">
												</h:outputText>
											</p:column>
										</p:dataTable>
									</h:panelGrid>
								</p:outputPanel>
							</p:tab>

							<p:tab title="#{msgs.lbl_contabilidad} (#{msgs.lbl_servicios})" id="tabDetalleContabilidad"
								rendered="#{notaCreditoFinancieraProveedorBean.indicadorNotaCreditoReversaGasto}">

								<p:outputPanel id="panelContabilidad">

									<p:dataTable filterDelay="#{sesionControler.retrasoFiltro}"
										value="#{notaCreditoFinancieraProveedorBean.listaDetalleFacturaProveedorServicios}" id="tablaDetalleFacturaProveedorServicios"
										binding="#{notaCreditoFinancieraProveedorBean.dtDetalleFacturaProveedorServicios}" emptyMessage="#{msgs.msg_no_hay_datos}"
										var="_detalleFacturaProveedorServicios" paginator="true" paginatorPosition="bottom" style="width:100%"
										rowKey="#{_detalleFacturaProveedorServicios.id}" rows="#{notaCreditoFinancieraProveedorBean.numeroFilas}"
										rowsPerPageTemplate="#{notaCreditoFinancieraProveedorBean.numeroFilasPorPagina}" columnClasses="rowIndex">

										<p:column styleClass="columnaDTActivo tableCell">
											<p:rowToggler rendered="#{_detalleFacturaProveedorServicios.producto.traIndicadorServicio}" />
										</p:column>

										<p:column headerText="#{msgs.lbl_codigo_producto}" styleClass="columnaDTCodigoProducto tableCell">
											<h:outputText value="#{_detalleFacturaProveedorServicios.producto.codigo}" />
										</p:column>

										<p:column headerText="#{msgs.lbl_nombre_producto}" styleClass="tableCell">
											<h:outputText value="#{_detalleFacturaProveedorServicios.producto.nombre}">
											</h:outputText>
										</p:column>

										<p:column headerText="#{msgs.lbl_base_imponible}" styleClass="columnaDTValor input-text-number tableCell">
											<h:outputText value="#{_detalleFacturaProveedorServicios.baseImponible}">
												<f:convertNumber pattern="#{notaCreditoFinancieraProveedorBean.formatoDinero}" />
											</h:outputText>
										</p:column>

										<p:column headerText="#{msgs.lbl_valor_impuesto}" styleClass="columnaDTValor input-text-number tableCell">
											<h:outputText value="#{_detalleFacturaProveedorServicios.valorImpuestosLinea}">
												<f:convertNumber pattern="#{notaCreditoFinancieraProveedorBean.formatoDinero}" />
											</h:outputText>
										</p:column>

										<p:column headerText="#{msgs.lbl_total}" styleClass="columnaDTValor input-text-number tableCell">
											<h:outputText rendered="#{_detalleFacturaProveedorServicios.producto.traIndicadorServicio}"
												value="#{_detalleFacturaProveedorServicios.baseImponible + _detalleFacturaProveedorServicios.valorImpuestosLinea}">
												<f:convertNumber pattern="#{notaCreditoFinancieraProveedorBean.formatoDinero}" />
											</h:outputText>
										</p:column>

										<p:column styleClass="columnaDTAccion tableCell">
											<p:commandButton value="#{msgs.btn_agregar}" action="#{notaCreditoFinancieraProveedorBean.agregarGastoProductoFacturaProveedorListener}"
												process="@this" update=":form:tabView:tablaDetalleFacturaProveedorServicios:panelGastoCuentaContable" icon="ui-icon-plus" />
										</p:column>

										<p:rowExpansion>

											<p:outputPanel id="panelGastoCuentaContable">

												<p:dataTable filterDelay="#{sesionControler.retrasoFiltro}" id="tablaGastoProductoFacturaProveedor"
													binding="#{notaCreditoFinancieraProveedorBean.dtGastoProductoFacturaProveedor}" emptyMessage="#{msgs.msg_no_hay_datos}" paginator="false"
													paginatorPosition="bottom" style="width:100%" value="#{_detalleFacturaProveedorServicios.listaGastoProductoFactura}"
													var="_gastoProductoFacturaProveedor" rowKey="#{_gastoProductoFacturaProveedor.id}"
													rows="#{notaCreditoFinancieraProveedorBean.numeroFilas}" rowsPerPageTemplate="#{notaCreditoFinancieraProveedorBean.numeroFilasPorPagina}"
													selectionMode="single">

													<p:column styleClass="columnaDTAccion tableCell">

														<p:commandButton value="..." process="@this" partialSubmit="true"
															actionListener="#{notaCreditoFinancieraProveedorBean.listaCuentaContableBean.listarCuentaContable}">

															<p:ajax event="dialogReturn" listener="#{notaCreditoFinancieraProveedorBean.seleccionarCuentaContable}"
																update=":form:tabView:tablaDetalleFacturaProveedorServicios:tablaGastoProductoFacturaProveedor"
																oncomplete="nextFocus('#{p:component('txtValorGasto')}')" />

															<f:setPropertyActionListener value="#{_gastoProductoFacturaProveedor}"
																target="#{notaCreditoFinancieraProveedorBean.gastoProductoFacturaProveedorSeleccionado}" />

														</p:commandButton>

													</p:column>

													<p:column headerText="#{msgs.lbl_codigo}" styleClass="columnaDTCodigoCuenta tableCell">
														<p:inputText id="txtCodigoCuentaGasto" value="#{_gastoProductoFacturaProveedor.cuentaContableGasto.codigo}" styleClass="input-text-col">
															<p:ajax listener="#{notaCreditoFinancieraProveedorBean.buscarCuentaContable}" process="@this"
																update=":form:tabView:tablaDetalleFacturaProveedorServicios:panelGastoCuentaContable"
																oncomplete="nextFocus(':form:tabView:tablaDetalleFacturaProveedorServicios:tablaGastoProductoFacturaProveedor:txtValorGasto')"
																event="change" />
														</p:inputText>
													</p:column>

													<p:column headerText="#{msgs.lbl_cuenta_contable}" styleClass="tableCell">
														<h:outputText id="txtNombreCuenta" value="#{_gastoProductoFacturaProveedor.cuentaContableGasto.nombre}" />
													</p:column>

													<p:column styleClass="columnaDTValor tableCell" headerText="#{msgs.lbl_valor}">
														<p:inputText id="txtValorGasto" value="#{_gastoProductoFacturaProveedor.valor}" styleClass="input-text-col">
															<p:ajax process="@this" update=":form:tabView:tablaDetalleFacturaProveedorServicios:panelGastoCuentaContable"
																oncomplete="nextFocus(':form:tabView:tablaDetalleFacturaProveedorServicios:tablaGastoProductoFacturaProveedor:txtCodigoCuentaGasto')" />
														</p:inputText>
													</p:column>

													<p:column styleClass="columnaDTNombre tableCell" rendered="#{not empty notaCreditoFinancieraProveedorBean.nombreDimension1}"
														headerText="#{notaCreditoFinancieraProveedorBean.nombreDimension1}">
														<h:panelGroup rendered="#{_gastoProductoFacturaProveedor.cuentaContableGasto.indicadorValidarDimension1}">

															<p:commandButton value="..." process="@this" partialSubmit="true"
																actionListener="#{notaCreditoFinancieraProveedorBean.listaDimensionContableBean.listarDimensionContableListener('1')}">
																<p:ajax event="dialogReturn" listener="#{notaCreditoFinancieraProveedorBean.seleccionarDimensionContableListener}"
																	update=":form:tabView:tablaDetalleFacturaProveedorServicios:panelGastoCuentaContable" />

																<f:setPropertyActionListener value="#{_gastoProductoFacturaProveedor}"
																	target="#{notaCreditoFinancieraProveedorBean.gastoProductoFacturaProveedorSeleccionado}" />

															</p:commandButton>
															<h:outputText value="#{_gastoProductoFacturaProveedor.dimensionContable1.nombre}" />
														</h:panelGroup>
													</p:column>

													<p:column rendered="#{not empty notaCreditoFinancieraProveedorBean.nombreDimension2}" styleClass="columnaDTNombre tableCell"
														headerText="#{notaCreditoFinancieraProveedorBean.nombreDimension2}">
														<h:panelGroup rendered="#{_gastoProductoFacturaProveedor.cuentaContableGasto.indicadorValidarDimension2}">
															<p:commandButton value="..." process="@this" partialSubmit="true"
																actionListener="#{notaCreditoFinancieraProveedorBean.listaDimensionContableBean.listarDimensionContableListener('2')}">
																<p:ajax event="dialogReturn" listener="#{notaCreditoFinancieraProveedorBean.seleccionarDimensionContableListener}"
																	update=":form:tabView:tablaDetalleFacturaProveedorServicios:panelGastoCuentaContable" />

																<f:setPropertyActionListener value="#{_gastoProductoFacturaProveedor}"
																	target="#{notaCreditoFinancieraProveedorBean.gastoProductoFacturaProveedorSeleccionado}" />

															</p:commandButton>
															<h:outputText value="#{_gastoProductoFacturaProveedor.dimensionContable2.nombre}" />
														</h:panelGroup>
													</p:column>

													<p:column rendered="#{not empty notaCreditoFinancieraProveedorBean.nombreDimension3}" styleClass="columnaDTNombre tableCell"
														headerText="#{notaCreditoFinancieraProveedorBean.nombreDimension3}">
														<h:panelGroup rendered="#{_gastoProductoFacturaProveedor.cuentaContableGasto.indicadorValidarDimension3}">
															<p:commandButton value="..." process="@this" partialSubmit="true"
																actionListener="#{notaCreditoFinancieraProveedorBean.listaDimensionContableBean.listarDimensionContableListener('3')}">
																<p:ajax event="dialogReturn" listener="#{notaCreditoFinancieraProveedorBean.seleccionarDimensionContableListener}"
																	update=":form:tabView:tablaDetalleFacturaProveedorServicios:panelGastoCuentaContable" />

																<f:setPropertyActionListener value="#{_gastoProductoFacturaProveedor}"
																	target="#{notaCreditoFinancieraProveedorBean.gastoProductoFacturaProveedorSeleccionado}" />

															</p:commandButton>
															<h:outputText value="#{_gastoProductoFacturaProveedor.dimensionContable3.nombre}" />
														</h:panelGroup>
													</p:column>

													<p:column rendered="#{not empty notaCreditoFinancieraProveedorBean.nombreDimension4}" styleClass="columnaDTNombre tableCell"
														headerText="#{notaCreditoFinancieraProveedorBean.nombreDimension4}">
														<h:panelGroup rendered="#{_gastoProductoFacturaProveedor.cuentaContableGasto.indicadorValidarDimension4}">
															<p:commandButton value="..." process="@this" partialSubmit="true"
																actionListener="#{notaCreditoFinancieraProveedorBean.listaDimensionContableBean.listarDimensionContableListener('4')}">
																<p:ajax event="dialogReturn" listener="#{notaCreditoFinancieraProveedorBean.seleccionarDimensionContableListener}"
																	update=":form:tabView:tablaDetalleFacturaProveedorServicios:panelGastoCuentaContable" />

																<f:setPropertyActionListener value="#{_gastoProductoFacturaProveedor}"
																	target="#{notaCreditoFinancieraProveedorBean.gastoProductoFacturaProveedorSeleccionado}" />

															</p:commandButton>
															<h:outputText value="#{_gastoProductoFacturaProveedor.dimensionContable4.nombre}" />
														</h:panelGroup>
													</p:column>

													<p:column rendered="#{not empty notaCreditoFinancieraProveedorBean.nombreDimension5}" styleClass="columnaDTNombre tableCell"
														headerText="#{notaCreditoFinancieraProveedorBean.nombreDimension5}">
														<h:panelGroup rendered="#{_gastoProductoFacturaProveedor.cuentaContableGasto.indicadorValidarDimension5}">
															<p:commandButton value="..." process="@this" partialSubmit="true"
																actionListener="#{notaCreditoFinancieraProveedorBean.listaDimensionContableBean.listarDimensionContableListener('5')}">
																<p:ajax event="dialogReturn" listener="#{notaCreditoFinancieraProveedorBean.seleccionarDimensionContableListener}"
																	update=":form:tabView:tablaDetalleFacturaProveedorServicios:panelGastoCuentaContable" />

																<f:setPropertyActionListener value="#{_gastoProductoFacturaProveedor}"
																	target="#{notaCreditoFinancieraProveedorBean.gastoProductoFacturaProveedorSeleccionado}" />

															</p:commandButton>
															<h:outputText value="#{_gastoProductoFacturaProveedor.dimensionContable5.nombre}" />
														</h:panelGroup>
													</p:column>


													<p:column styleClass="columnaDTAccion tableCell">
														<p:commandButton id="btnEliminarGastoProductoFacturaProveedor"
															action="#{notaCreditoFinancieraProveedorBean.eliminarGastoProductoFacturaProveedor}" icon="ui-icon-trash" title="#{msgs.lbl_eliminar}"
															update=":form:tabView:tablaDetalleFacturaProveedorServicios:panelGastoCuentaContable" process="@this">
														</p:commandButton>
													</p:column>

													<p:columnGroup type="footer">
														<p:row>
															<p:column colspan="3" footerText="#{msgs.lbl_total}:" style="text-align:right">
															</p:column>
															<p:column style="text-align:right" footerText="#{_detalleFacturaProveedorServicios.valorGastoContable}" />
															<p:column />
															<p:column />
														</p:row>
														<p:row>
															<p:column colspan="3" footerText="#{msgs.lbl_diferencia}" style="text-align:right" />

															<p:column style="text-align:right"
																footerText="#{(_detalleFacturaProveedorServicios.baseImponible + _detalleFacturaProveedorServicios.valorImpuestosLinea) -_detalleFacturaProveedorServicios.valorGastoContable}" />
															<p:column />
															<p:column />
														</p:row>

													</p:columnGroup>
												</p:dataTable>
											</p:outputPanel>
										</p:rowExpansion>
									</p:dataTable>
								</p:outputPanel>
							</p:tab>
						</p:tabView>
					</p:panel>
				</p:outputPanel>

				<p:outputPanel id="panelListado">

					<p:panel header="#{msgs.lbl_panel_listado} #{msgs.lbl_nota_credito_proveedor_panel}" rendered="#{!notaCreditoFinancieraProveedorBean.editado}">

						<p:dataTable filterDelay="#{sesionControler.retrasoFiltro}" id="tablaNotaCreditoProveedor" rowIndexVar="secuencial"
							emptyMessage="#{msgs.msg_no_hay_datos}" value="#{notaCreditoFinancieraProveedorBean.listaNotaCreditoProveedor}" var="_notaCreditoProveedor"
							paginator="true" binding="#{notaCreditoFinancieraProveedorBean.dtFacturaProveedor}" rows="#{notaCreditoFinancieraProveedorBean.numeroFilas}"
							paginatorPosition="bottom" style="width:100%" rowsPerPageTemplate="#{notaCreditoFinancieraProveedorBean.numeroFilasPorPagina}"
							selection="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor}" selectionMode="single" rowKey="#{_notaCreditoProveedor.id}"
							sortBy="#{_notaCreditoProveedor.numero}" sortOrder="DESCENDING" lazy="true">

							<p:column headerText="Nº" styleClass="columnaDTAccion tableCell">
								<h:outputText value="#{secuencial+1}" />
							</p:column>

							<p:column sortBy="#{_notaCreditoProveedor.numero}" filterBy="#{_notaCreditoProveedor.numero}" styleClass="columnaDTNombreCorto tableCell">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_numero}" />
								</f:facet>
								<h:outputText value="#{_notaCreditoProveedor.numero}" />
							</p:column>

							<p:column sortBy="#{_notaCreditoProveedor.fecha}" styleClass="columnaDTFecha tableCell">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_fecha}" />
								</f:facet>
								<h:outputText value="#{_notaCreditoProveedor.fecha}">
									<f:convertDateTime pattern="#{notaCreditoFinancieraProveedorBean.formatoFecha}" />
								</h:outputText>
							</p:column>

							<p:column sortBy="#{_notaCreditoProveedor.facturaProveedorSRI.numero}" filterBy="#{_notaCreditoProveedor.facturaProveedorSRI.numero}"
								styleClass="columnaDTNumeroFactura tableCell">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_sri_serie_secuencial}" />
								</f:facet>
								<h:outputText rendered="#{_notaCreditoProveedor.documento.indicadorDocumentoTributario}"
									value="#{_notaCreditoProveedor.facturaProveedorSRI.establecimiento}-#{_notaCreditoProveedor.facturaProveedorSRI.puntoEmision}-#{_notaCreditoProveedor.facturaProveedorSRI.numero}" />
							</p:column>

							<p:column sortBy="#{_notaCreditoProveedor.facturaProveedorPadre.facturaProveedorSRI.numero}"
								filterBy="#{_notaCreditoProveedor.facturaProveedorPadre.facturaProveedorSRI.numero}" styleClass="columnaDTNumeroFactura tableCell">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_numero_facturaSRI}" />
								</f:facet>

								<h:link rendered="#{not empty _notaCreditoProveedor.facturaProveedorPadre}" target="_blank"
									outcome="/paginas/compras/procesos/facturaProveedor" includeViewParams="true"
									value="#{_notaCreditoProveedor.facturaProveedorPadre.facturaProveedorSRI.establecimiento}-#{_notaCreditoProveedor.facturaProveedorPadre.facturaProveedorSRI.puntoEmision}-#{_notaCreditoProveedor.facturaProveedorPadre.facturaProveedorSRI.numero}">
									<f:param name="numero" value="#{_notaCreditoProveedor.facturaProveedorPadre.numero}" />
								</h:link>
							</p:column>

							<p:column sortBy="#{_notaCreditoProveedor.empresa.nombreFiscal}" filterBy="#{_notaCreditoProveedor.empresa.nombreFiscal}"
								styleClass="tableCell">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_proveedor}" />
								</f:facet>
								<h:outputText value="#{_notaCreditoProveedor.empresa.nombreFiscal}" />
							</p:column>

							<p:column sortBy="#{_notaCreditoProveedor.total}" styleClass="columnaDTValor input-text-number tableCell">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_subtotal}" />
								</f:facet>
								<h:outputText value="#{_notaCreditoProveedor.total}">
									<f:convertNumber pattern="#{notaCreditoFinancieraProveedorBean.formatoDinero}" />
								</h:outputText>
							</p:column>

							<p:column sortBy="#{_notaCreditoProveedor.impuesto}" styleClass="columnaDTValor input-text-number tableCell">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_producto_indicador_impuestos}" />
								</f:facet>
								<h:outputText value="#{_notaCreditoProveedor.impuesto}">
									<f:convertNumber pattern="#{notaCreditoFinancieraProveedorBean.formatoDinero}" />
								</h:outputText>
							</p:column>

							<p:column styleClass="columnaDTValor input-text-number tableCell">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_total}" />
								</f:facet>
								<h:outputText value="#{_notaCreditoProveedor.totalFactura}">
									<f:convertNumber pattern="#{notaCreditoFinancieraProveedorBean.formatoDinero}" />
								</h:outputText>
							</p:column>

							<p:column styleClass="columnaDTNombreCorto tableCell">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_anticipo_proveedor_abreviatura}" />
								</f:facet>
								<h:link rendered="#{not empty _notaCreditoProveedor.anticipoProveedor}" target="_blank"
									outcome="/paginas/financiero/pagos/procesos/anticipoProveedor" includeViewParams="true"
									value="#{_notaCreditoProveedor.anticipoProveedor.numero}">
									<f:param name="numeroAnticipo" value="#{_notaCreditoProveedor.anticipoProveedor.numero}" />
								</h:link>
							</p:column>

							<p:column styleClass="columnaDTValor input-text-number tableCell" filterBy="#{_notaCreditoProveedor.anticipoProveedor.saldo}"
								sortBy="#{_notaCreditoProveedor.anticipoProveedor.saldo}">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_liquidacion_anticipo_proveedor_diferencia}" />
								</f:facet>
								<h:outputText value="#{_notaCreditoProveedor.anticipoProveedor.saldo}">
									<f:convertNumber pattern="#{notaCreditoFinancieraProveedorBean.formatoDinero}" />
								</h:outputText>
							</p:column>

							<p:column sortBy="#{_notaCreditoProveedor.asiento.numero}" filterBy="#{_notaCreditoProveedor.asiento.numero}"
								styleClass="columnaDTNombreCorto tableCell">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_asiento}" />
								</f:facet>
								<h:link rendered="#{not empty _notaCreditoProveedor.asiento}" target="_blank"
									outcome="/paginas/financiero/contabilidad/procesos/asientoContable" includeViewParams="true" value="#{_notaCreditoProveedor.asiento.numero}">
									<f:param name="idAsiento" value="#{_notaCreditoProveedor.asiento.idAsiento}" />
								</h:link>
							</p:column>

							<p:column sortBy="#{_notaCreditoProveedor.sucursal.nombre}" filterBy="#{_notaCreditoProveedor.sucursal.nombre}"
								styleClass="columnaDTEstado tableCell">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_sucursal}" />
								</f:facet>
								<h:outputText value="#{_notaCreditoProveedor.sucursal.nombre}" />
							</p:column>

							<p:column sortBy="#{_notaCreditoProveedor.estado}" filterBy="#{_notaCreditoProveedor.estado}"
								filterOptions="#{notaCreditoFinancieraProveedorBean.listaEstadoItem}" styleClass="columnaDTEstado tableCell">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_estado}" />
								</f:facet>
								<h:outputText value="#{_notaCreditoProveedor.estado.nombre}" />
							</p:column>

							<p:column headerText="#{msgs.lbl_descripcion}" styleClass="tableCell" filterBy="#{_notaCreditoProveedor.descripcion}">
								<p:outputLabel value="#{_notaCreditoProveedor.descripcion}" />
							</p:column>

							<p:column styleClass="columnaDTCantidad" exportable="false">

								<as2:fileManager target="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor}" value="#{_notaCreditoProveedor}"
									bean="#{notaCreditoFinancieraProveedorBean}" formatos="/(\.|\/)(pdf|png|xml|jpe?g)$/" actualiza=":form:panelListado"
									visible="#{_notaCreditoProveedor.pdf!=null}" />

							</p:column>
						</p:dataTable>
					</p:panel>
				</p:outputPanel>

				<ui:include src="/template/auditoriaRapida.xhtml">
					<ui:param name="fechaCreacion" value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.fechaCreacion}" />
					<ui:param name="usuarioCreacion" value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.usuarioCreacion}" />

					<ui:param name="fechaModificacion" value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.fechaModificacion}" />
					<ui:param name="usuarioModificacion" value="#{notaCreditoFinancieraProveedorBean.notaCreditoProveedor.usuarioModificacion}" />

				</ui:include>
			</p:outputPanel>
		</h:form>
	</ui:define>
</ui:composition>
</html>