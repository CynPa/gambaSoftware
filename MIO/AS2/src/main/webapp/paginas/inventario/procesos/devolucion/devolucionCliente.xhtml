<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core" xmlns:p="http://primefaces.org/ui" xmlns:tnt="http://java.sun.com/jsf/composite/componentes"
	xmlns:as2="http://java.sun.com/jsf/composite/componentes">

<f:metadata>
	<f:viewParam name="numeroDevolucion" value="#{devolucionClienteBean.numeroDevolucion}" />
</f:metadata>

<ui:composition template="/template/template.xhtml">

	<ui:define name="contenido">

		<h:form prependId="false" id="form">

			<p:outputPanel id="panelContenedor">

				<as2:toolBar bean="#{devolucionClienteBean}">
					<as2:buttonEliminar bean="#{devolucionClienteBean}" titulo="#{msgs.btn_anular}">
						<h:outputText value="#{msgs.lbl_indicador_movimiento}:#" />
						<h:outputText value="#{devolucionClienteBean.devolucionCliente.numero}" />

						<h:outputText value="#{msgs.lbl_cliente}:" />
						<h:outputText value="#{devolucionClienteBean.devolucionCliente.empresa.nombreComercial}" />

						<h:outputText value="#{msgs.lbl_valor}:" />
						<h:outputText value="#{devolucionClienteBean.devolucionCliente.totalFactura}" />
					</as2:buttonEliminar>

					<as2:buttonImprimir id="btnImprimirDevolucionCliente" beanReporte="#{reporteDevolucionClienteBean}" bean="#{devolucionClienteBean}"
						target="#{reporteDevolucionClienteBean.devolucionCliente}" value="#{devolucionClienteBean.devolucionCliente}" />
					
					<as2:buttonImprimir beanReporte="#{reporteAsientoBean}" bean="#{devolucionClienteBean}" target="#{reporteAsientoBean.asiento}"
						value="#{devolucionClienteBean.devolucionCliente.asiento}" etiquetaImprimir="#{msgs.lbl_imprimir_asiento}"/>	
						
					<h:panelGroup>
						<as2:buttonImprimir id="btnImprimirDevolucionClienteDetallado" beanReporte="#{reporteDevolucionClienteDetalladoBean}"
							bean="#{devolucionClienteBean}" target="#{reporteDevolucionClienteDetalladoBean.devolucionCliente}"
							value="#{devolucionClienteBean.devolucionCliente}" etiquetaImprimir="#{msgs.lbl_detallado}" />
					</h:panelGroup>

					<as2:buttonExportaExcel bean="#{devolucionClienteBean}" tabla=":form:tablaDevolucion" />
					<as2:buttonEnviarMail id="btnEnviarMail" bean="#{devolucionClienteBean}" />
					
					<p:commandButton ajax="false" icon="xml" process="@this" title="XMl">
						<p:fileDownload value="#{devolucionClienteBean.XMLSRI}" />
					</p:commandButton>
				</as2:toolBar>

				<ui:include src="/template/nuevoLote.xhtml">
					<ui:param name="bean" value="#{devolucionClienteBean}" />
					<ui:param name="objetoActualizar" value=":form:tabView:panelDetalleFactura" />
				</ui:include>

				<p:outputPanel id="panelErrores">
					<p:dialog header="Listado de errores" widgetVar="dialogoErrores" modal="true" height="400" width="800">
						<p:dataTable filterDelay="#{sesionControler.retrasoFiltro}" value="#{devolucionClienteBean.exContabilizacion.mensajes}" var="_mensaje"
							rowIndexVar="secuencial">

							<p:column headerText="Nº">
								<h:outputText value="#{secuencial+1}" />
							</p:column>

							<p:column headerText="Error">
								<h:outputText value="#{_mensaje}" />
							</p:column>

						</p:dataTable>
					</p:dialog>
				</p:outputPanel>

				<p:outputPanel id="panelNuevo">

					<p:panel header="#{msgs.lbl_panel_edicion} #{msgs.lbl_devolucion_cliente_panel}" rendered="#{devolucionClienteBean.editado}">

						<ui:include src="/template/listaProductoMultiple.xhtml">
							<ui:param name="bean" value="#{devolucionClienteBean}" />
							<ui:param name="objetoActualizar" value=":form:tabView:panelDetalleFactura" />
							<ui:param name="mostrarCantidad" value="true" />
						</ui:include>

						<p:fieldset>

							<h:panelGrid id="panelCabecera" columns="#{devolucionClienteBean.numeroColumnasPanelNuevo}"
								columnClasses="columnaEtiqueta,columnaValor,columnaEtiqueta,columnaValor">

								<h:outputText value="#{msgs.lbl_documento}:" />
								<p:selectOneMenu styleClass="input-text" value="#{devolucionClienteBean.devolucionCliente.documento}" id="cboDocumento"
									required="true">
									<f:selectItem itemValue="" itemLabel="#{msgs.lbl_seleccione}" />
									<f:selectItems value="#{devolucionClienteBean.listaDocumento}" var="_documento" itemLabel="#{_documento.nombre}"
										itemValue="#{_documento}" />

									<p:ajax process="@this" update="@form" event="change" listener="#{devolucionClienteBean.actualizarDocumento}" />

									<f:validateBean />
								</p:selectOneMenu>

								<h:outputText value="#{msgs.lbl_numero}:" />
								<p:inputMask styleClass="input-text" value="#{devolucionClienteBean.devolucionCliente.numero}" id="txtNumero"
									mask="#{devolucionClienteBean.devolucionCliente.documento.secuencia.patron}"
									disabled="#{devolucionClienteBean.devolucionCliente.idFacturaCliente == 0 and (devolucionClienteBean.indicadorAutoimpresor or devolucionClienteBean.devolucionCliente.documento.indicadorDocumentoElectronico)}">
									<f:validateBean />
								</p:inputMask>

								<h:outputText value="#{msgs.lbl_fecha}:" />
								<p:calendar
									pattern="#{devolucionClienteBean.formatoFecha}" showOn="button" navigator="true" value="#{devolucionClienteBean.devolucionCliente.fecha}"
									id="calFecha" required="true">
								</p:calendar>

								<p:outputLabel for="autoEmpresa" value="#{msgs.lbl_cliente}:" />
								<p:autoComplete disabled="#{devolucionClienteBean.devolucionCliente.idFacturaCliente != 0}" queryDelay="#{sesionControler.retrasoFiltro}"
									styleClass="input-text" id="autoEmpresa" value="#{devolucionClienteBean.devolucionCliente.empresa}"
									completeMethod="#{devolucionClienteBean.autocompletarClientes}" var="_cliente" itemLabel="#{_cliente.nombreFiscal}" itemValue="#{_cliente}"
									forceSelection="true" dropdown="true" minQueryLength="2" required="true">

									<p:column headerText="#{msgs.lbl_empresa_identificacion}">#{_cliente.identificacion}</p:column>
									<p:column headerText="#{msgs.lbl_empresa_nombre_fiscal}">#{_cliente.nombreFiscal}</p:column>
									<p:column headerText="#{msgs.lbl_empresa_nombre_comercial}">#{_cliente.nombreComercial}</p:column>

									<p:ajax listener="#{devolucionClienteBean.actualizarCliente}" process="@this" event="itemSelect"
										update="autoFactura,cboDireccionCliente,cboSubempresa,:form:txtEmail" />

								</p:autoComplete>

								<h:outputText value="#{msgs.lbl_subcliente}:" />
								<p:selectOneMenu disabled="#{devolucionClienteBean.devolucionCliente.idFacturaCliente != 0}" styleClass="input-text"
									value="#{devolucionClienteBean.devolucionCliente.subempresa}" id="cboSubempresa">
									<f:selectItem itemValue="" itemLabel="#{msgs.lbl_seleccione}" />
									<f:selectItems value="#{devolucionClienteBean.listaSubempresa}" var="_subempresa" itemValue="#{_subempresa}"
										itemLabel="#{_subempresa.empresaFinal}" />
									<p:ajax event="change" listener="#{devolucionClienteBean.actualizarSubclienteListener}" process="@this" update="cboDireccionCliente, txtEmail"></p:ajax>
								</p:selectOneMenu>


								<p:outputLabel for="cboDireccionCliente" value="#{msgs.lbl_empresa_direccion_factura}:" />
								<p:selectOneMenu value="#{devolucionClienteBean.devolucionCliente.direccionEmpresa}" id="cboDireccionCliente" required="true">
									<f:selectItem itemValue="" itemLabel="#{msgs.lbl_seleccione}" />
									<f:selectItems value="#{devolucionClienteBean.listaDireccionEmpresa}" var="_dir" itemValue="#{_dir}" itemLabel="#{_dir.direccionCompleta}" />
								</p:selectOneMenu>

								<h:panelGroup>
									<p:outputLabel for="autoFactura" value="#{msgs.lbl_factura}:" />
									<p:commandButton id="btnCargarFactura" title="#{msgs.btn_cargar_ultima_factura}" icon="ui-icon-arrowstop-1-n"
										update="autoFactura,cboDireccionCliente,cboSubempresa, :form:tabView:panelDetalleFactura, :form:tabView:panelImpuestoDetalleFactura"
										actionListener="#{devolucionClienteBean.seleccionarUltimaFactura}" process="@this" />
								</h:panelGroup>
								<p:autoComplete
									disabled="#{devolucionClienteBean.devolucionCliente.idFacturaCliente != 0 or not empty devolucionClienteBean.devolucionCliente.despachoCliente}"
									queryDelay="#{sesionControler.retrasoFiltro}" styleClass="input-text" id="autoFactura"
									value="#{devolucionClienteBean.devolucionCliente.facturaClientePadre}" completeMethod="#{devolucionClienteBean.autocompletarFacturas}"
									var="_factura" itemLabel="#{_factura.numero}" itemValue="#{_factura}" forceSelection="true" dropdown="true" minQueryLength="2"
									required="#{devolucionClienteBean.devolucionCliente.documento.indicadorDocumentoTributario}">

									<p:column>
										<h:outputText value="#{_factura.numero}" />
									</p:column>

									<p:column>
										<h:outputText value=" #{_factura.fecha}">
											<f:convertDateTime pattern="#{devolucionClienteBean.formatoFecha}" />
										</h:outputText>
									</p:column>

									<p:ajax listener="#{devolucionClienteBean.actualizarFactura}" process="@this" event="itemSelect"
										update="autoFactura,cboDireccionCliente,cboSubempresa, :form:tabView:panelDetalleFactura, :form:tabView:panelImpuestoDetalleFactura" />

								</p:autoComplete>

								<p:outputLabel id="lblDespacho" for="autoDespacho" value="#{msgs.lbl_despacho}:"
									rendered="#{!devolucionClienteBean.devolucionCliente.documento.indicadorDocumentoTributario}" />
								<p:autoComplete id="autoDespacho" disabled="#{devolucionClienteBean.devolucionCliente.idFacturaCliente != 0}" queryDelay="#{sesionControler.retrasoFiltro}"
									styleClass="input-text"  value="#{devolucionClienteBean.devolucionCliente.despachoCliente}"
									completeMethod="#{devolucionClienteBean.autocompletarDespachos}" var="_despacho" itemLabel="#{_despacho.numero}" itemValue="#{_despacho}"
									forceSelection="true" dropdown="true" minQueryLength="2"
									rendered="#{!devolucionClienteBean.devolucionCliente.documento.indicadorDocumentoTributario}">

									<p:column>
										<h:outputText value="#{_despacho.numero}" />
									</p:column>

									<p:column>
										<h:outputText value=" #{_despacho.fecha}">
											<f:convertDateTime pattern="#{devolucionClienteBean.formatoFecha}" />
										</h:outputText>
									</p:column>

									<p:ajax process="@this" event="itemSelect" listener="#{devolucionClienteBean.actualizarFacturaDesdeDespacho}"
										update="autoFactura,cboDireccionCliente, :form:tabView:panelDetalleFactura, :form:tabView:panelImpuestoDetalleFactura autoFactura" />

								</p:autoComplete>

								<p:outputLabel for="cboMotivoDevolucion" value="#{msgs.lbl_motivo} #{msgs.lbl_devolucion}:" />
								<p:selectOneMenu styleClass="input-text" value="#{devolucionClienteBean.devolucionCliente.motivoNotaCreditoCliente}" id="cboMotivoDevolucion"
									required="true">
									<f:selectItem itemValue="" itemLabel="#{msgs.lbl_seleccione}" />
									<f:selectItems value="#{devolucionClienteBean.listaMotivoNotaCreditoCliente}" var="_motivoDevolucion" itemLabel="#{_motivoDevolucion.nombre}"
										itemValue="#{_motivoDevolucion}" />
									<f:validateBean />
									<p:ajax update="@this" process="@this"/>
								</p:selectOneMenu>

								<p:outputLabel for="txtEmail" value="#{msgs.lbl_email}:" />
								<p:inputText styleClass="input-text" value="#{devolucionClienteBean.devolucionCliente.email}" id="txtEmail"
									required="#{devolucionClienteBean.devolucionCliente.documento.indicadorDocumentoElectronico}">
									<f:validateBean />
								</p:inputText>

								<h:outputText value="#{msgs.lbl_descripcion}:" />
								<p:inputTextarea styleClass="input-text" value="#{devolucionClienteBean.devolucionCliente.descripcion}" id="txtDescripcionCabecera" size="100"
									maxlength="200">
									<f:validateBean />
								</p:inputTextarea>
							</h:panelGrid>

						</p:fieldset>

						<p:spacer width="2px" />

						<p:tabView id="tabView" cache="true" dynamic="true">

							<p:tab title="#{msgs.lbl_devolucion_cliente_detalle}" id="tabDetalleNC">

								<p:outputPanel id="panelDetalleFactura">

									<h:panelGrid columns="1" id="panelDetalle" style="width:100%">

										<p:panel rendered="#{devolucionClienteBean.facturaClienteSaldoInicial or devolucionClienteBean.agregarDetalle}">
											<h:panelGroup>
												<p:commandButton value="#{msgs.btn_agregar_detalle}" id="btnAgregarDetalle" action="#{devolucionClienteBean.agregarDetalle}"
													update=":form:tabView:panelDetalleFactura,:form:tabView:panelImpuestoDetalleFactura" process="@this" icon="ui-icon-plus" />

												<p:commandButton value="#{msgs.lbl_listar_producto}" icon="ui-icon-plus" onclick="dglModalProducto.show();" type="button" />
											</h:panelGroup>
										</p:panel>

										<p:dataTable filterDelay="#{sesionControler.retrasoFiltro}" value="#{devolucionClienteBean.listaDetalleFC}"
											id="tablaDetalleFacturaCLiente" rowIndexVar="secuencial" binding="#{devolucionClienteBean.dtDetalleDevolucionCliente}"
											emptyMessage="#{msgs.msg_no_hay_datos}" var="_detalleDevolucion" paginator="true" paginatorPosition="bottom" style="width:100%"
											rows="#{devolucionClienteBean.numeroFilas}" rowsPerPageTemplate="#{devolucionClienteBean.numeroFilasPorPagina}"
											rowKey="#{_detalleDevolucion.rowKey}"  sortOrder="ASCENDING" filteredValue="#{devolucionClienteBean.listaDetalleFCFilter}" >

											<p:column styleClass="tableCell columnaDTAccion" headerText="Nº">
												<h:outputText value="#{secuencial+1}" />
											</p:column>

											<p:column sortBy ="#{_detalleDevolucion.producto.codigo}"   styleClass="tableCell columnaDTCodigoProducto" headerText="#{msgs.lbl_codigo}">
												<p:outputPanel rendered="#{devolucionClienteBean.facturaClienteSaldoInicial or devolucionClienteBean.agregarDetalle}">
													<p:autoComplete queryDelay="#{sesionControler.retrasoFiltro}" styleClass="input-text" value="#{_detalleDevolucion.producto}"
														completeMethod="#{devolucionClienteBean.autocompletarProductos}" var="_producto" itemLabel="#{_producto.codigo}"
														itemValue="#{_producto}" dropdown="false" minQueryLength="2" id="txtCodigoProducto">
														<p:column headerText="#{msgs.lbl_codigo}">#{_producto.codigo}</p:column>
														<p:column headerText="#{msgs.lbl_codigo_alterno}">#{_producto.codigoAlterno}</p:column>
														<p:column headerText="#{msgs.lbl_nombre}">#{_producto.nombre}</p:column>
														
														<p:ajax listener="#{devolucionClienteBean.actualizarProductoListener}" process="@this :form:calFecha" event="itemSelect" global="false"
															update=":form:tabView:panelDetalleFactura,:form:tabView:panelImpuestoDetalleFactura" oncomplete="nextFocus(':form:txtCantidad')" />
														<f:validateBean />
													</p:autoComplete>
												</p:outputPanel>
												<p:outputPanel rendered="#{!devolucionClienteBean.facturaClienteSaldoInicial and !devolucionClienteBean.agregarDetalle}">
													<h:outputText value="#{_detalleDevolucion.producto.codigo}" />
												</p:outputPanel>
											</p:column>

											<p:column sortBy="#{_detalleDevolucion.producto.nombre}"  styleClass="tableCell" headerText="#{msgs.lbl_nombre_producto}">
												<h:outputText value="#{_detalleDevolucion.producto.nombre}" />
											</p:column>

											<p:column styleClass="tableCell columnaDTBodega" headerText="#{msgs.lbl_bodega}">
												<p:selectOneMenu disabled="#{devolucionClienteBean.devolucionCliente.idFacturaCliente != 0}" styleClass="input-text"
													value="#{_detalleDevolucion.bodega}" id="cboBodega" required="true">
													<f:selectItem itemValue="" itemLabel="#{msgs.lbl_seleccione}" />
													<f:selectItems value="#{devolucionClienteBean.listaBodega}" var="_bodega" itemLabel="#{_bodega.nombre}" itemValue="#{_bodega}" />
													<p:ajax event="select" process="@this" global="false" />
											<p:ajax event="change" process="@this" global="false" />

												</p:selectOneMenu>
											</p:column>

											<p:column styleClass="tableCell columnaDTUnidad" headerText="#{msgs.lbl_unidad_producto}">
												<h:outputText value="#{_detalleDevolucion.unidadVenta.nombre}" id="txtUnidadProducto">
												</h:outputText>
											</p:column>


											<p:column headerText="#{msgs.lbl_cantidad}" styleClass="tableCell columnaDTCantidad">
												<h:outputText value="#{empty _detalleDevolucion.detalleFacturaClientePadre? _detalleDevolucion.detalleDespachoClienteNoFacturado.cantidadPorDevolver:_detalleDevolucion.detalleFacturaClientePadre.detalleDespachoCliente.cantidadPorDevolver}" />
											</p:column>

											<p:column styleClass="tableCell columnaDTValorGrande" headerText="#{msgs.lbl_cantidad_a_devolver}">
												<p:inputText disabled="#{devolucionClienteBean.devolucionCliente.idFacturaCliente != 0}" styleClass="input-text100"
													value="#{_detalleDevolucion.cantidad}" id="txtCantidad">
													<p:ajax listener="#{devolucionClienteBean.totalizar}" process="@this lblDescuentoLinea cboBodega txtPrecio" event="change"
														update=":form:tabView:panelDetalleFactura, :form:tabView:panelImpuestoDetalleFactura" partialSubmit="true" />
												</p:inputText>
											</p:column>

											<p:column headerText="#{msgs.lbl_peso}" styleClass="tableCell columnaDTCantidad" rendered="#{devolucionClienteBean.indicadorManejoPeso}">
												<h:outputText value="#{empty _detalleDevolucion.detalleFacturaClientePadre?_detalleDevolucion.detalleDespachoCliente.peso:_detalleDevolucion.detalleFacturaClientePadre.detalleDespachoCliente.peso}" />
											</p:column>

											<p:column styleClass="tableCell columnaDTCantidad" headerText="#{msgs.lbl_peso_a_devolver}"
												rendered="#{devolucionClienteBean.indicadorManejoPeso}">
												<p:inputText disabled="#{devolucionClienteBean.devolucionCliente.idFacturaCliente != 0}" styleClass="input-text100"
													value="#{_detalleDevolucion.peso}" rendered="#{_detalleDevolucion.producto.indicadorManejoPeso}">
													<p:ajax listener="#{devolucionClienteBean.totalizar}" process="@this lblDescuentoLinea cboBodega txtPrecio" event="change"
														update=":form:tabView:panelDetalleFactura, :form:tabView:panelImpuestoDetalleFactura" partialSubmit="true" />
												</p:inputText>
											</p:column>

											<p:column sortBy="#{_detalleDevolucion.inventarioProducto.lote.codigo}" styleClass="tableCell columnaDTCodigo" headerText="#{msgs.lbl_lote}">
												<h:outputText value="#{_detalleDevolucion.inventarioProducto.lote.codigo}" id="txtLote" />
											</p:column>

											<p:column styleClass="tableCell columnaDTAccion">
												<p:commandButton icon="ui-icon-newwin" id="btnCrearLote" rendered="#{_detalleDevolucion.producto.indicadorLote}"
													update=":form:panelListaInventarioProductoLote" process="@this" oncomplete="dglModalInventarioProductoLote.show();"
													action="#{devolucionClienteBean.creacionLote}" disabled="#{_detalleDespachoCliente.id>0}" title="#{msgs.lbl_crear} #{msgs.lbl_lote}">
												</p:commandButton>
											</p:column>

											<p:column styleClass="tableCell columnaDTValorGrande" headerText="#{msgs.lbl_precio_unitario}">
												<p:outputPanel rendered="#{devolucionClienteBean.facturaClienteSaldoInicial}">
													<p:inputText value="#{_detalleDevolucion.precio}" id="txtPrecio">
														<p:ajax listener="#{devolucionClienteBean.totalizar}" process="@this lblDescuentoLinea cboBodega txtPrecio txtCantidad" event="change"
															update=":form:tabView:panelDetalleFactura, :form:tabView:panelImpuestoDetalleFactura" />
													</p:inputText>
												</p:outputPanel>
												<p:outputPanel rendered="#{!devolucionClienteBean.facturaClienteSaldoInicial}">
													<h:outputText value="#{_detalleDevolucion.precio}" >
													<f:convertNumber pattern="#{devolucionClienteBean.formatoDinero}" />
												</h:outputText>
												</p:outputPanel>
											</p:column>

											<p:column styleClass="tableCell columnaDTValor" headerText="#{msgs.lbl_descuento_unitario}">
												<h:outputText value="#{_detalleDevolucion.descuento}" style="text-align:right" id="lblDescuentoLinea">
													<f:convertNumber pattern="#{devolucionClienteBean.formatoDinero}" />
												</h:outputText>
											</p:column>

											<p:column styleClass="tableCell columnaDTValor" headerText="#{msgs.lbl_precio_linea}">
												<h:outputText value="#{_detalleDevolucion.precioLinea}" style="text-align:right" id="lblPrecioLinea">
													<f:convertNumber pattern="#{devolucionClienteBean.formatoDinero}" />
												</h:outputText>
											</p:column>

											<p:column styleClass="tableCell columnaDTActivo" headerText="#{msgs.lbl_producto_indicador_impuestos}">
												<p:selectBooleanCheckbox disabled="true" value="#{_detalleDevolucion.indicadorImpuesto}" />
											</p:column>

											<p:column styleClass="tableCell" width="50">
												<f:facet name="header">
													<p:commandLink disabled="#{devolucionClienteBean.devolucionCliente.idFacturaCliente != 0}" id="btnSeleccionarTodos"
														process="@this :form:tabView:panelDetalleFactura" global="false" title="#{msgs.lbl_seleccionar}"
														update=":form:tabView:panelDetalleFactura, :form:tabView:panelImpuestoDetalleFactura" action="#{devolucionClienteBean.seleccionarTodos}">
														<h:graphicImage library="images" name="action_icon.png" style="height : 16px; width : 16px;" />
													</p:commandLink>

													<p:commandLink disabled="#{devolucionClienteBean.devolucionCliente.idFacturaCliente != 0}" id="btnLimpiarTodos"
														process="@this :form:tabView:panelDetalleFactura" global="false" title="#{msgs.lbl_limpiar}"
														update=":form:tabView:panelDetalleFactura, :form:tabView:panelImpuestoDetalleFactura" action="#{devolucionClienteBean.limpiarTodos}">
														<h:graphicImage library="images" name="eraser.png" style="height : 16px; width : 16px;" />
													</p:commandLink>
												</f:facet>

												<p:commandLink disabled="#{devolucionClienteBean.devolucionCliente.idFacturaCliente != 0}" id="btnSeleccionar"
													process="@this lblDescuentoLinea cboBodega txtPrecio txtCantidad" global="false" title="#{msgs.lbl_seleccionar}"
													update=":form:tabView:panelDetalleFactura, :form:tabView:panelImpuestoDetalleFactura"
													action="#{devolucionClienteBean.cargarCantidadADevolver(_detalleDevolucion)}">
													<h:graphicImage library="images" name="action_icon.png" style="height : 16px; width : 16px;" />
												</p:commandLink>

												<p:spacer width="5px" />

												<p:commandLink disabled="#{devolucionClienteBean.devolucionCliente.idFacturaCliente != 0}" id="btnLimpiar"
													process="@this lblDescuentoLinea cboBodega txtPrecio txtCantidad" global="false" title="#{msgs.lbl_limpiar}"
													update=":form:tabView:panelDetalleFactura, :form:tabView:panelImpuestoDetalleFactura"
													action="#{devolucionClienteBean.limpiarCantidadADevolver(_detalleDevolucion)}">
													<h:graphicImage library="images" name="eraser.png" style="height : 16px; width : 16px;" />
												</p:commandLink>
											</p:column>

											<p:column styleClass="tableCell columnaDTAccion">
												<p:commandButton disabled="#{devolucionClienteBean.devolucionCliente.idFacturaCliente != 0}" id="btnEliminarDetalle"
													action="#{devolucionClienteBean.eliminarDetalle}" icon="ui-icon-trash" title="#{msgs.lbl_eliminar}"
													update=":form:tabView:panelDetalleFactura,:form:tabView:panelImpuestoDetalleFactura" process="@this">
												</p:commandButton>
											</p:column>

											<p:columnGroup type="footer" id="panelTotal">
												<p:row>
													<p:column colspan="#{devolucionClienteBean.indicadorManejoPeso ? 13 : 11}" footerText="#{msgs.lbl_subtotal}:	" style="text-align:right">
													</p:column>
													<p:column>
														<f:facet name="footer" style="text-align:right" id="txtTotal">
															<h:outputText value="#{devolucionClienteBean.devolucionCliente.total}">
																<f:convertNumber pattern="#{devolucionClienteBean.formatoDinero}" />
															</h:outputText>
														</f:facet>
													</p:column>
													<p:column></p:column>
													<p:column></p:column>
													<p:column></p:column>
												</p:row>
												<p:row>
													<p:column colspan="#{devolucionClienteBean.indicadorManejoPeso ? 13 : 11}" footerText="#{msgs.lbl_descuento}:" style="text-align:right">
													</p:column>
													<p:column>
														<f:facet name="footer" style="text-align:right" id="txtDescuento">
															<h:outputText value="#{devolucionClienteBean.devolucionCliente.descuento}">
																<f:convertNumber pattern="#{devolucionClienteBean.formatoDinero}" />
															</h:outputText>
														</f:facet>
													</p:column>
													<p:column></p:column>
													<p:column></p:column>
													<p:column></p:column>
												</p:row>
												
												<p:row
													rendered="#{devolucionClienteBean.devolucionCliente.montoIce > 0}">
													<p:column colspan="#{devolucionClienteBean.indicadorManejoPeso ? 13 : 11}" footerText="#{msgs.lbl_indicador_impuesto_ice}:"
														style="text-align:right">
													</p:column>
													<p:column>
														<f:facet name="footer" style="text-align:right" id="txtICE">
															<h:outputText value="#{devolucionClienteBean.devolucionCliente.facturaClienteSRI.montoIce}">
																<f:convertNumber pattern="#{devolucionClienteBean.formatoDinero}" />
															</h:outputText>
														</f:facet>
													</p:column>
													<p:column></p:column>
													<p:column></p:column>
													<p:column></p:column>
												</p:row>

												<p:row>
													<p:column colspan="#{devolucionClienteBean.indicadorManejoPeso ? 13 : 11}" footerText="#{msgs.lbl_producto_indicador_impuestos}:"
														style="text-align:right">
													</p:column>
													<p:column>
														<f:facet name="footer" style="text-align:right" id="txtImpuesto">
															<h:outputText value="#{devolucionClienteBean.devolucionCliente.impuesto}">
																<f:convertNumber pattern="#{devolucionClienteBean.formatoDinero}" />
															</h:outputText>
														</f:facet>
													</p:column>
													<p:column></p:column>
													<p:column></p:column>
													<p:column></p:column>
												</p:row>
												<p:row>
													<p:column colspan="#{devolucionClienteBean.indicadorManejoPeso ? 13 : 11}" footerText="#{msgs.lbl_descuento_impuesto}"
														style="text-align:right">
													</p:column>
													<p:column>
														<f:facet name="footer">
															<h:outputText value="#{devolucionClienteBean.devolucionCliente.descuentoImpuesto}" style="text-align:right" id="txtDescuentoImpuesto">
																<f:convertNumber pattern="#{devolucionClienteBean.formatoDinero}" />
															</h:outputText>
														</f:facet>
													</p:column>
													<p:column></p:column>
													<p:column></p:column>
													<p:column></p:column>
												</p:row>
												<p:row>
													<p:column colspan="#{devolucionClienteBean.indicadorManejoPeso ? 13 : 11}" footerText="#{msgs.lbl_total}:" style="text-align:right">
													</p:column>
													<p:column>
														<f:facet name="footer" style="text-align:right" id="txtSubtotal">
															<h:outputText value="#{devolucionClienteBean.devolucionCliente.totalFactura}">
																<f:convertNumber pattern="#{devolucionClienteBean.formatoDinero}" />
															</h:outputText>
														</f:facet>
													</p:column>
													<p:column></p:column>
													<p:column></p:column>
													<p:column></p:column>
												</p:row>
											</p:columnGroup>

										</p:dataTable>

									</h:panelGrid>

								</p:outputPanel>

							</p:tab>

							<p:tab title="#{msgs.lbl_detalle_impuesto}" id="tabImpuestoDetalleFactura">

								<p:outputPanel id="panelImpuestoDetalleFactura">

									<h:panelGrid columns="1" id="panelImpuestoDetalle" style="width:100%">

										<p:dataTable filterDelay="#{sesionControler.retrasoFiltro}" value="#{devolucionClienteBean.listaImpuestoProductoNC}"
											id="tablaImpuestoDetalleFacturaCLiente" rowIndexVar="secuencial" binding="#{devolucionClienteBean.dtImpuestoDevolucion}"
											emptyMessage="#{msgs.msg_no_hay_datos}" var="_impuestoDetalleNC" paginator="true" paginatorPosition="bottom" style="width:100%"
											rowsPerPageTemplate="#{devolucionClienteBean.numeroFilasPorPagina}" rows="#{devolucionClienteBean.numeroFilas}"
											rowKey="#{_impuestoDetalleNC.id}" lazy="true">

											<p:column styleClass="tableCell columnaDTAccion" headerText="Nº">
												<h:outputText value="#{secuencial+1}" />
											</p:column>

											<p:column styleClass="tableCell columnaDTNombre" headerText="#{msgs.lbl_nombre_producto}">
												<h:outputText value="#{_impuestoDetalleNC.detalleFacturaCliente.producto.nombreComercial}" />
											</p:column>

											<p:column styleClass="tableCell columnaDTNombre" headerText="#{msgs.lbl_nombre_impuesto}">
												<h:outputText value="#{_impuestoDetalleNC.impuesto.nombre}" id="txtNombreProductoImpuesto">
												</h:outputText>
											</p:column>

											<p:column styleClass="tableCell columnaDTValor" headerText="#{msgs.lbl_porcentaje_impuesto}">
												<h:outputText value="#{_impuestoDetalleNC.porcentajeImpuesto}" id="txtPorcentajeProductoImpuesto" style="text-align:right">
												</h:outputText>
											</p:column>

											<p:column styleClass="tableCell columnaDTValor" headerText="#{msgs.lbl_base_imponible}">
												<h:outputText
													value="#{_impuestoDetalleNC.impuesto.tipoImpuesto == 'AFECTA_CANTIDAD_UNIDADES' ? _impuestoDetalleNC.cantidadUnidades : _impuestoDetalleNC.detalleFacturaCliente.baseImponible}"
													id="txtBaseImpuesto" style="text-align:right">
												</h:outputText>
											</p:column>

											<p:column styleClass="tableCell columnaDTValor" headerText="#{msgs.lbl_valor_impuesto}">
												<h:outputText value="#{_impuestoDetalleNC.impuestoProducto}" id="txtImpuestoProducto" style="text-align:right">
												</h:outputText>
											</p:column>

										</p:dataTable>

									</h:panelGrid>

								</p:outputPanel>
							</p:tab>

						</p:tabView>

					</p:panel>

				</p:outputPanel>

				<p:outputPanel id="panelListado">

					<p:panel header="#{msgs.lbl_panel_listado} #{msgs.lbl_devolucion_cliente_panel}" rendered="#{!devolucionClienteBean.editado}">

						<p:dataTable filterDelay="#{sesionControler.retrasoFiltro}" id="tablaDevolucion" rowIndexVar="secuencial"
							emptyMessage="#{msgs.msg_no_hay_datos}" value="#{devolucionClienteBean.listaDevolucionCliente}" var="_devolucionCliente" paginator="true"
							binding="#{devolucionClienteBean.dtDevolucionCliente}" rows="#{devolucionClienteBean.numeroFilas}" paginatorPosition="bottom"
							style="width:100%" rowsPerPageTemplate="#{devolucionClienteBean.numeroFilasPorPagina}" selection="#{devolucionClienteBean.devolucionCliente}"
							selectionMode="single" rowKey="#{_devolucionCliente.id}" sortBy="#{_devolucionCliente.fechaCreacion}" sortOrder="DESCENDING" lazy="true">

							<p:column styleClass="tableCell columnaDTAccion" headerText="Nº">
								<h:outputText value="#{secuencial+1}" />
							</p:column>

							<p:column styleClass="tableCell columnaDTNumeroFactura" sortBy="#{_devolucionCliente.numero}" filterBy="#{_devolucionCliente.numero}">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_numero}" />
								</f:facet>
								<h:outputText value="#{_devolucionCliente.numero}" />
							</p:column>

							<p:column styleClass="tableCell columnaDTFecha" sortBy="#{_devolucionCliente.fecha}">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_fecha}" />
								</f:facet>
								<h:outputText value="#{_devolucionCliente.fecha}">
									<f:convertDateTime pattern="#{devolucionClienteBean.formatoFecha}" />
								</h:outputText>
							</p:column>

							<p:column styleClass="tableCell columnaDTNumeroFactura" sortBy="#{_devolucionCliente.facturaClientePadre.numero}">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_factura}" />
								</f:facet>
								<h:link rendered="#{not empty _devolucionCliente.facturaClientePadre}" target="_blank" outcome="/paginas/ventas/procesos/facturaCliente"
									includeViewParams="true" value="#{_devolucionCliente.facturaClientePadre.numero}">
									<f:param name="idFacturaCliente" value="#{_devolucionCliente.facturaClientePadre.idFacturaCliente}" />
								</h:link>
							</p:column>

							<p:column styleClass="tableCell columnaDTNombre" sortBy="#{_devolucionCliente.empresa.nombreFiscal}"
								filterBy="#{_devolucionCliente.empresa.nombreFiscal}">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_cliente}" />
								</f:facet>
								<h:outputText value="#{_devolucionCliente.empresa.nombreFiscal}" />
							</p:column>

							<p:column styleClass="tableCell columnaDTValor" sortBy="#{_devolucionCliente.total}">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_subtotal}" />
								</f:facet>
								<h:outputText value="#{_devolucionCliente.total}">
									<f:convertNumber pattern="#{devolucionClienteBean.formatoDinero}" />
								</h:outputText>
							</p:column>

							<p:column styleClass="tableCell columnaDTValor" sortBy="#{_devolucionCliente.descuento}">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_descuento}" />
								</f:facet>
								<h:outputText value="#{_devolucionCliente.descuento}">
									<f:convertNumber pattern="#{devolucionClienteBean.formatoDinero}" />
								</h:outputText>
							</p:column>

							<p:column styleClass="columnaDTValor tableCell">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_indicador_impuesto_ice}" />
								</f:facet>
								<h:outputText value="#{_devolucionCliente.montoIce}">
									<f:convertNumber pattern="#{devolucionClienteBean.formatoDinero}" />
								</h:outputText>
							</p:column>
							
							<p:column styleClass="tableCell columnaDTActivo" sortBy="#{_devolucionCliente.impuesto}">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_producto_indicador_impuestos}" />
								</f:facet>
								<h:outputText value="#{_devolucionCliente.impuesto}">
									<f:convertNumber pattern="#{devolucionClienteBean.formatoDinero}" />
								</h:outputText>
							</p:column>
							
							<p:column styleClass="columnaDTValor tableCell" sortBy="#{_devolucionCliente.descuentoImpuesto}">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_descuento_impuesto}" />
								</f:facet>

								<h:outputText value="#{_devolucionCliente.descuentoImpuesto}">
									<f:convertNumber pattern="#{devolucionClienteBean.formatoDinero}" />
								</h:outputText>
							</p:column>

							<p:column styleClass="tableCell columnaDTValorGrande">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_total}" />
								</f:facet>
								<h:outputText value="#{_devolucionCliente.totalFactura}">
									<f:convertNumber pattern="#{devolucionClienteBean.formatoDinero}" />
								</h:outputText>
							</p:column>

							<p:column styleClass="tableCell columnaDTNumeroFactura">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_anticipo_cliente_abreviatura}" />
								</f:facet>

								<h:link rendered="#{not empty _devolucionCliente.anticipoCliente}" target="_blank"
									outcome="/paginas/financiero/cobros/procesos/anticipoCliente" includeViewParams="true" value="#{_devolucionCliente.anticipoCliente.numero}">
									<f:param name="numeroAnticipo" value="#{_devolucionCliente.anticipoCliente.numero}" />
								</h:link>
							</p:column>

							<p:column styleClass="tableCell columnaDTNumeroFactura" sortBy="#{_devolucionCliente.asiento.numero}"
								filterBy="#{_devolucionCliente.asiento.numero}">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_asiento}" />
								</f:facet>

								<h:link rendered="#{not empty _devolucionCliente.asiento}" target="_blank" outcome="/paginas/financiero/contabilidad/procesos/asientoContable"
									includeViewParams="true" value="#{_devolucionCliente.asiento.numero}">
									<f:param name="idAsiento" value="#{_devolucionCliente.asiento.idAsiento}" />
								</h:link>
							</p:column>

							<p:column styleClass="tableCell columnaDTNombreCorto" sortBy="#{_devolucionCliente.estado}" filterBy="#{_devolucionCliente.estado}"
								filterOptions="#{devolucionClienteBean.listaEstadoItem}">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_estado}" />
								</f:facet>
								<h:outputText value="#{_devolucionCliente.estado.nombre}" />
							</p:column>

							<p:column styleClass="tableCell" headerText="#{msgs.lbl_descripcion}" sortBy="#{_devolucionCliente.descripcion}"
								filterBy="#{_devolucionCliente.descripcion}">
								<h:outputText value="#{_devolucionCliente.descripcion}" />
							</p:column>

							<p:column sortBy="#{_devolucionCliente.facturaClienteSRI.mensajeSRI}" filterBy="#{_devolucionCliente.facturaClienteSRI.mensajeSRI}">
								<f:facet name="header">
									<h:outputText value="#{msgs.lbl_estado } SRI" />
								</f:facet>

								<as2:inputTextNota value="#{_devolucionCliente.facturaClienteSRI.mensajeSRI}" />
							</p:column>

							<p:column headerText="#{msgs.lbl_codigo} Movil" sortBy="#{_devolucionCliente.codigoMovil}" filterBy="#{_devolucionCliente.codigoMovil}">
								<h:outputText value="#{_devolucionCliente.codigoMovil}" />
							</p:column>

							<p:column styleClass="columnaDTCantidad" exportable="false">

								<as2:fileManager target="#{devolucionClienteBean.devolucionCliente}" value="#{_devolucionCliente}" bean="#{devolucionClienteBean}"
									formatos="/(\.|\/)(pdf|png|jpe?g)$/" actualiza=":form:panelListado" visible="#{_devolucionCliente.archivo!=null}" />

							</p:column>

						</p:dataTable>
					</p:panel>
				</p:outputPanel>

				<p:separator />

				<ui:include src="/template/auditoriaRapida.xhtml">
					<ui:param name="fechaCreacion" value="#{devolucionClienteBean.devolucionCliente.fechaCreacion}" />
					<ui:param name="usuarioCreacion" value="#{devolucionClienteBean.devolucionCliente.usuarioCreacion}" />

					<ui:param name="fechaModificacion" value="#{devolucionClienteBean.devolucionCliente.fechaModificacion}" />
					<ui:param name="usuarioModificacion" value="#{devolucionClienteBean.devolucionCliente.usuarioModificacion}" />

				</ui:include>

			</p:outputPanel>

		</h:form>

	</ui:define>

</ui:composition>

</html>
